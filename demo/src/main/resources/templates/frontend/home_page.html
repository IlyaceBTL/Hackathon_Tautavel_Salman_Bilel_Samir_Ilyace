<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" th:href="@{/style_page.css}" />
  <title>Hackaton Tautavel : Equipe 3 Projet Ours du Denninger</title>
</head>
<body>
  <div class="layout">
    <h1 class="titre" th:text="${animal?.name} ?: 'Ours de Deninger'">Ours de Deninger</h1>

    <div class="hexagone">
      <div class="hexagonemain">
        <img th:src="@{/vitrine-ours.png}" alt="Ours de Denninger" class="hex-img" />
        
        <!-- Zones cliquables pour chaque os -->
        <div class="bone-zone" data-bone="crane" style="left: 48%; top: 30%; width: 12%; height: 15%;">
          <div class="bone-label">Cr√¢ne</div>
        </div>
        <div class="bone-zone" data-bone="mandibule" style="left: 48%; top: 43%; width: 8%; height: 8%;">
          <div class="bone-label">Mandibule</div>
        </div>
        <div class="bone-zone" data-bone="vertebres" style="left: 32%; top: 22%; width: 18%; height: 12%;">
          <div class="bone-label">Vert√®bres</div>
        </div>
        <div class="bone-zone" data-bone="cotes" style="left: 28%; top: 32%; width: 22%; height: 18%;">
          <div class="bone-label">C√¥tes</div>
        </div>
        <div class="bone-zone" data-bone="humerus-d" style="left: 68%; top: 42%; width: 9%; height: 20%;">
          <div class="bone-label">Hum√©rus Droit</div>
        </div>
        <div class="bone-zone" data-bone="humerus-g" style="left: 22%; top: 42%; width: 9%; height: 20%;">
          <div class="bone-label">Hum√©rus Gauche</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal d'information avec mod√®le 3D int√©gr√© -->
  <div class="modal" id="boneModal" aria-hidden="true">
    <div class="modal-content" role="dialog" aria-modal="true">
      <button class="close-btn" id="closeModal" aria-label="Fermer">‚úï</button>
      <h2 class="modal-title" id="modalTitle">Os s√©lectionn√©</h2>
      <p class="modal-description" id="modalDescription">Description de l'os...</p>
      <button class="audio-btn" id="audioBtn">üîä √âcouter</button>
      
      <!-- Mod√®le 3D int√©gr√© dans le modal -->
      <div id="conteneur-canvas-3d"></div>
      <div class="info-3d-text">üñ±Ô∏è Utilisez la souris pour tourner et zoomer</div>
    </div>
  </div>

  <!-- Import map pour Three.js -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
  </script>

  <!-- Script 3D modal -->
  <script type="module" th:src="@{/script_3d_modal.js}"></script>

  <!-- Injecter les donn√©es Thymeleaf AVANT d'inclure main.js -->
  <script th:inline="javascript">
    window.osList = /*[[${animal?.os}]]*/ [];
  </script>

  <script th:src="@{/main.js}"></script>

  <!-- Script pour g√©rer les clics sur les zones d'os -->
  <script>
    // Attendre que le DOM soit charg√©
    document.addEventListener('DOMContentLoaded', function() {
      const boneZones = document.querySelectorAll('.bone-zone');
      const modal = document.getElementById('boneModal');
      const closeBtn = document.getElementById('closeModal');

      boneZones.forEach(zone => {
        zone.addEventListener('click', function() {
          // R√©cup√©rer le nom de l'os
          const boneName = this.getAttribute('data-bone');
          console.log("Clic sur : " + boneName);
          
          // Ouvrir le modal
          modal.classList.add('active');
          
          // Initialiser ou mettre √† jour le mod√®le 3D
          setTimeout(() => {
            if (window.ouvrirModal3D) {
              window.ouvrirModal3D(boneName);
            }
          }, 100);
        });
      });

      // Fermer le modal
      closeBtn.addEventListener('click', function() {
        modal.classList.remove('active');
        if (window.fermerModal3D) {
          window.fermerModal3D();
        }
      });

      // Fermer en cliquant en dehors
      modal.addEventListener('click', function(e) {
        if (e.target === modal) {
          modal.classList.remove('active');
          if (window.fermerModal3D) {
            window.fermerModal3D();
          }
        }
      });
    });
  </script>
</body>
</html>